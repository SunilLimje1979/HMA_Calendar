{% comment %} {% load i18n %}
{% load static %}
{% load pwa %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>"Default Page"</title>
    <link rel="manifest" href="{% static 'manifest.json' %}">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
    <link rel="shortcut icon" href="{% static 'images/HMALogo.png' %}">
    <style>
        /* Styling for the content container */
        .container {
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .logo {
            max-width: 200px;
            margin-bottom: 20px;
        }

        .message {
            font-size: 20px;
            margin-bottom: 20px;
        }

        .install-btn {
            font-size: 16px;
            padding: 12px 24px;
            background-color: #109787;
            color: white;
            border: none;
            cursor: pointer;
        }

        .install-btn i {
            margin-right: 8px;
        }

        .install-btn:hover {
            background-color: #0f7f72;
        }
    </style>
</head>
<body>
    <div class="container" id="app-container">
        <img src="{% static 'images/HMALogo.png' %}" alt="HMA Logo" class="logo" id="logo">
        <p class="message" id="message">{% trans "Download the App to Use our Calendar" %}</p>
        <button class="install-btn" id="install" hidden>
            <i class="fas fa-download"></i>
            {% trans "Download as Mobile App" %}
        </button>
    </div>

    <script>
        let installPrompt = null;
        const installButton = document.querySelector("#install");
        const appContainer = document.querySelector("#app-container");

        // URL to redirect after the app is installed
        const redirectUrl = "/HMA_Calendar/calendar/";

        // Check if the app is already installed and redirect if true
        if (window.matchMedia('(display-mode: standalone)').matches) {
            window.location.href = redirectUrl;
            console.log("redirectUrl");
        }

        window.addEventListener("beforeinstallprompt", (event) => {
            event.preventDefault();
            installPrompt = event;
            installButton.removeAttribute("hidden");
        });

        installButton.addEventListener("click", async () => {
            if (!installPrompt) return;
            const result = await installPrompt.prompt();
            console.log(`Install prompt was: ${result.outcome}`);
            disableInAppInstallPrompt();
        });

        window.addEventListener("appinstalled", () => {
            // Redirect to the URL after the app is installed
            window.location.href = redirectUrl;
        });

        function disableInAppInstallPrompt() {
            installPrompt = null;
            installButton.setAttribute("hidden", "");
        }
    </script>

</body>
</html> {% endcomment %}
{% load i18n %}
{% load static %}
{% load pwa %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>"Default Page"</title>
    <link rel="manifest" href="{% static 'manifest.json' %}">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
    <link rel="shortcut icon" href="{% static 'images/HMALogo.png' %}">
    <style>
        .container {
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .logo {
            max-width: 200px;
            margin-bottom: 20px;
        }

        .message {
            font-size: 20px;
            margin-bottom: 20px;
        }

        .install-btn {
            font-size: 16px;
            padding: 12px 24px;
            background-color: #109787;
            color: white;
            border: none;
            cursor: pointer;
        }

        .install-btn i {
            margin-right: 8px;
        }

        .install-btn:hover {
            background-color: #0f7f72;
        }
    </style>
</head>
<body>
    <div class="container" id="app-container">
        <img src="{% static 'images/HMALogo.png' %}" alt="HMA Logo" class="logo" id="logo">
        <p class="message" id="message">{% trans "Download the App to Use our Calendar" %}</p>
        <button class="install-btn" id="install" hidden>
            <i class="fas fa-download"></i>
            {% trans "Download as Mobile App" %}
        </button>
    </div>

    <script>
        let installPrompt = null;
        const installButton = document.querySelector("#install");
        const appContainer = document.querySelector("#app-container");

        // URL to redirect after the app is installed
        const redirectUrl = "/HMA_Calendar/calendar/";

        // Debugging message to check the standalone mode
        console.log("Checking if app is installed: ", window.matchMedia('(display-mode: standalone)').matches);

        // Check if the app is already installed and redirect if true
        if (window.matchMedia('(display-mode: standalone)').matches) {
            console.log("App is already installed, redirecting...");
            window.location.href = redirectUrl;
        }

        // Handle the beforeinstallprompt event
        window.addEventListener("beforeinstallprompt", (event) => {
            event.preventDefault();
            installPrompt = event;
            installButton.removeAttribute("hidden");
        });

        installButton.addEventListener("click", async () => {
            if (!installPrompt) return;
            const result = await installPrompt.prompt();
            console.log(`Install prompt was: ${result.outcome}`);
            disableInAppInstallPrompt();
        });

        // Listen for the appinstalled event
        window.addEventListener("appinstalled", () => {
            console.log("App has been installed, redirecting...");
            window.location.href = redirectUrl;
        });

        // Disable the install prompt after installation
        function disableInAppInstallPrompt() {
            installPrompt = null;
            installButton.setAttribute("hidden", "");
            console.log(redirectUrl);
            window.location.href = redirectUrl;
        }
    </script>

</body>
</html>
